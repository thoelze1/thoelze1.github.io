<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-02-09 Wed 23:56 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Running Linux on a MacBook</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Tanner Hoelzel" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title">Running Linux on a MacBook</h1>
<p>
There are many existing resources for installing and running Linux on
Apple hardware. This guide attempts to serve as a table of contents
for those resources, with additional tips and context included.
</p>

<p>
Disclaimer: every single time I have adjusted the boot process of my
macbook, something horrible has at some point seemed to occur: the
laptop bricked, macOS partition corrupted, etc. That being said, the
situation has always been recoverable. If you mess with your boot
process, expect something bad to happen but maybe don't let that stop
you from experimenting.
</p>

<div id="outline-container-org3ec1f29" class="outline-2">
<h2 id="org3ec1f29">Before installing</h2>
<div class="outline-text-2" id="text-org3ec1f29">
<p>
It's good to understand some aspects of the OS X/macOS system
(hereafter "macOS") before making adjustments. Most important
are firmware updates, Apple's UEFI implementation, and <kbd>bless(8)</kbd>.
</p>
</div>

<div id="outline-container-org006e5e8" class="outline-3">
<h3 id="org006e5e8">Firmware updates</h3>
<div class="outline-text-3" id="text-org006e5e8">
<p>
The easiest (and only, AFAIK) way to update firmware is through the
"Software Update" feature of macOS. For that reason, it's a good idea
to retain a bootable copy of macOS, either as a partition on the same
drive as Linux or on a separate drive entirely. It might also be a
good idea to make a bootable macOS installer. See <a href="https://support.apple.com/en-us/HT201371">Apple's guide</a> for
instructions.
</p>
</div>
</div>

<div id="outline-container-org67653ee" class="outline-3">
<h3 id="org67653ee">UEFI</h3>
<div class="outline-text-3" id="text-org67653ee">
<p>
On startup, a macbook boots to whichever EFI entry has the highest
priority. The process can be interrupted by holding a certain key
combination at startup (see <a href="https://support.apple.com/en-us/HT201255">Mac startup key combinations</a>) to trigger
Apple's rudimentary boot manager. If you forget to hold the correct
key combination at startup, the UEFI may boot an entry you did not
intend, at which point you will have to reboot and try again.
</p>
</div>
</div>

<div id="outline-container-orga1612e5" class="outline-3">
<h3 id="orga1612e5"><kbd>bless(8)</kbd></h3>
<div class="outline-text-3" id="text-orga1612e5">
<p>
The <kbd>bless</kbd> utility is widely reported to be buggy, which matches my
experience with it. I would recommend using <kbd>efibootmgr</kbd> (the standard
alternative on Linux) entirely.
</p>
</div>
</div>

<div id="outline-container-org181fec6" class="outline-3">
<h3 id="org181fec6">EFI System Partition (ESP)</h3>
<div class="outline-text-3" id="text-org181fec6">
<p>
By default, Apple's Disk Utility hides the ESP. You can still mount it
from a terminal:
</p>
<div class="org-src-container">
<pre class="src src-bash">diskutil list
mkdir /Volumes/efi
sudo mount -t msdos /dev/diskXsY /Volumes/efi
</pre>
</div>
<p>
(where <kbd>diskXsY</kbd> is the ESP as ascertained by <kbd>diskutil list</kbd>)
</p>
</div>
</div>
</div>

<div id="outline-container-org6970629" class="outline-2">
<h2 id="org6970629">Installing Linux</h2>
<div class="outline-text-2" id="text-org6970629">
<p>
There are a number of ways to structure the process of booting Linux,
which will include some number of the following components:
</p>
<ul class="org-ul">
<li>Apple's UEFI implementation</li>
<li>A boot manager, such as rEFInd or rEFIt</li>
<li>A boot loader, such as GRUB2</li>
<li>An initial ramdisk (to be passed, along with the kernel, to the
bootloader)</li>
<li>A Linux kernel, perhaps with an EFI-stub</li>
</ul>

<p>
Your use case should dictate which structure you choose. If you plan
on regularly booting to different operating systems, you should use
the <a href="https://www.rodsbooks.com/refind/">rEFInd</a> boot manager (if only so that you don't have to remember to
press the correct key combination at every startup). If you want a
user-friendly boot process that will (probably) "just work" then you
should also use rEFInd. If you're installing a popular
Linux distribution as-is OOTB, you'll probably use a Linux kernel
(without EFI stub) and an initial ramdisk. If you want a simple boot
process with as few steps as possible, you can get away with booting
an EFI kernel stub (without even an initial ramdisk) directly from
Apple's UEFI.
</p>
</div>

<div id="outline-container-org8e4b6c1" class="outline-3">
<h3 id="org8e4b6c1">Using the rEFInd boot manager</h3>
<div class="outline-text-3" id="text-org8e4b6c1">
<p>
rEFInd has great documentation where you can find installation
instructions and a detailed feature list. There are two primary ways
to use rEFInd: invoke a Linux kernel bootloader (e.g. GRUB2) or load a
Linux kernel EFI stub.
</p>
</div>

<div id="outline-container-org1559a85" class="outline-4">
<h4 id="org1559a85">Invoking the GRUB2 bootloader from rEFInd</h4>
<div class="outline-text-4" id="text-org1559a85">
<p>
This is the "standard" way of dual-booting Linux. Installation might
look like this:
</p>
<ol class="org-ol">
<li>Install rEFInd</li>
<li>Insert installation media of a chosen GNU/Linux distribution</li>
<li>Reboot</li>
<li>In the rEFInd menu, select the installation media as the boot target</li>
<li>Follow installation instructions (at some point, the installer will
automatically add a boot entry to the ESP partition)</li>
<li>Reboot</li>
<li>In the rEFInd menu, you can choose from the boot targets that
rEFInd has found in the ESP partition</li>
</ol>
<p>
You're dual-booting!
</p>
</div>
</div>

<div id="outline-container-org2bd630b" class="outline-4">
<h4 id="org2bd630b">Loading a kernel EFI stub from rEFInd</h4>
<div class="outline-text-4" id="text-org2bd630b">
<p>
This method is very similar to the above, but may require a more
manual installation process. For a how-to, see
<a href="https://www.makeuseof.com/tag/install-linux-macbook-pro/">https://www.makeuseof.com/tag/install-linux-macbook-pro/</a>.
</p>
</div>
</div>
</div>

<div id="outline-container-orga613946" class="outline-3">
<h3 id="orga613946">Using Apple's boot manager</h3>
<div class="outline-text-3" id="text-orga613946">
<p>
You may be able to get by without a third-party boot manager. However,
on some Apple hardware, booting non-macOS operating systems from EFI
may result in improper hardware initialization (see <a href="https://regebro.wordpress.com/2008/11/16/installing-linux-on-a-macbook-without-os-x/">this story</a> for an
example). In such cases, it might be necessary to use rEFInd to force
proper initialization (or at least to use a bootloader in BIOS compatibility
mode, like GRUB2).
</p>

<p>
Again, you can invoke a bootloader or load an EFI stub.
</p>
</div>

<div id="outline-container-orgf5b260b" class="outline-4">
<h4 id="orgf5b260b">Invoking GRUB2 from Apple's UEFI</h4>
<div class="outline-text-4" id="text-orgf5b260b">
<p>
For a full guide, see:
</p>
<ul class="org-ul">
<li>This <a href="https://askubuntu.com/questions/831161/dual-booting-os-x-or-macos-with-linux-without-refind/1272785#1272785">stackoverflow post</a></li>
<li><a href="https://glandium.org/blog/?p=2830">https://glandium.org/blog/?p=2830</a></li>
</ul>
</div>
</div>

<div id="outline-container-org315a318" class="outline-4">
<h4 id="org315a318">Loading a Linux kernel with EFI stub from Apple's UEFI</h4>
<div class="outline-text-4" id="text-org315a318">
<p>
This <a href="https://stackoverflow.com/questions/28842865/passing-kernel-parametes-to-efi-stub-in-apples-efi-env/">stackoverflow post</a> has full instructions. They boil down to:
</p>
<ol class="org-ol">
<li>Create an <kbd>HFS+</kbd> partition large enough to hold a kernel stub and
(optionally) initial ramdisk (which were ~6MB and ~36MB in my
experience)</li>
<li>Copy the kernel stub and initial ramdisk to the partition</li>
<li>Rename the kernel stub so that it ends with <kbd>.efi</kbd></li>
<li><p>
Create a new boot entry pointing to your new partition:
</p>
<div class="org-src-container">
<pre class="src src-bash">efibootmgr -d /dev/sdX -p Y -c -L <span style="color: #8b2252;">"Debian (EFI-Stub)"</span> -l /vmlinuz.efi -u <span style="color: #8b2252;">"root=UUID=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx ro quiet splash initrd=\initrd.img"</span>
</pre>
</div></li>
</ol>
<p>
Note: see this <a href="https://askubuntu.com/questions/831161/dual-booting-os-x-or-macos-with-linux-without-refind#comment2103658_832609">stackoverflow comment</a> by the author of rEFInd for
thoughts about this boot sequence.
</p>
</div>

<ul class="org-ul">
<li><a id="orge7f2433"></a>Without initial ramdisk<br />
<div class="outline-text-5" id="text-orge7f2433">
<p>
The same steps apply, but you must use <kbd>root=PARTUUID=...</kbd> instead of
<kbd>root=UUID=...</kbd>. See this <a href="https://www.reddit.com/r/Gentoo/comments/ivrfyf/comment/g5ujnm1/">reddit comment</a> for an explanation.
</p>
</div>
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org8d622c9" class="outline-2">
<h2 id="org8d622c9">Troubleshooting</h2>
<div class="outline-text-2" id="text-org8d622c9">
<ul class="org-ul">
<li>Unable to partition disk, even though there should be room
<ul class="org-ul">
<li><a href="https://discussions.apple.com/thread/8501670">https://discussions.apple.com/thread/8501670</a></li>
</ul></li>
<li>macOS partition unbootable after creating partition
<ul class="org-ul">
<li><a href="https://discussions.apple.com/thread/6511990">https://discussions.apple.com/thread/6511990</a></li>
<li><a href="https://ipfs-sec.stackexchange.cloudflare-ipfs.com/apple/A/question/282550.html">https://ipfs-sec.stackexchange.cloudflare-ipfs.com/apple/A/question/282550.html</a></li>
<li><a href="https://apple.stackexchange.com/questions/238012/os-volume-shows-as-type-ffffffff-ffff-ffff-ffff-ffffffff-after-attempting-to-d/238088#238088">https://apple.stackexchange.com/questions/238012/os-volume-shows-as-type-ffffffff-ffff-ffff-ffff-ffffffff-after-attempting-to-d/238088#238088</a></li>
<li><a href="https://apple.stackexchange.com/questions/307780/macos-partition-startup-volume-type-ffffffff-ffff-ffff-ffff-ffffffffffff">https://apple.stackexchange.com/questions/307780/macos-partition-startup-volume-type-ffffffff-ffff-ffff-ffff-ffffffffffff</a></li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org7ca0713" class="outline-2">
<h2 id="org7ca0713">References</h2>
<div class="outline-text-2" id="text-org7ca0713">
<ul class="org-ul">
<li><a href="https://www.reddit.com/r/linux/comments/4rnufy/people_who_run_linux_on_macbooks_is_it_worth_it/">https://www.reddit.com/r/linux/comments/4rnufy/people_who_run_linux_on_macbooks_is_it_worth_it/</a></li>
<li><a href="https://www.reddit.com/r/hackintosh/comments/7sprm3/is_it_possible_to_run_a_hackintosh_off_an/">https://www.reddit.com/r/hackintosh/comments/7sprm3/is_it_possible_to_run_a_hackintosh_off_an/</a></li>
<li><a href="https://wiki.archlinux.org/index.php/Mac#Firmware_updates">https://wiki.archlinux.org/index.php/Mac#Firmware_updates</a></li>
<li><a href="https://askubuntu.com/questions/894036/what-is-the-current-best-way-to-dual-boot-a-mac-with-ubuntu-on-the-latest-10-12">https://askubuntu.com/questions/894036/what-is-the-current-best-way-to-dual-boot-a-mac-with-ubuntu-on-the-latest-10-12</a></li>
<li><a href="https://www.reddit.com/r/Gentoo/comments/ivrfyf/kernel_panic_on_boot/">https://www.reddit.com/r/Gentoo/comments/ivrfyf/kernel_panic_on_boot/</a></li>
<li><a href="https://askubuntu.com/questions/831161/dual-booting-os-x-or-macos-with-linux-without-refind">https://askubuntu.com/questions/831161/dual-booting-os-x-or-macos-with-linux-without-refind</a></li>
<li><a href="https://themacadmin.com/2012/02/15/mounting-the-efi-boot-partition-on-mac-os-x/">https://themacadmin.com/2012/02/15/mounting-the-efi-boot-partition-on-mac-os-x/</a></li>
</ul>
</div>
</div>
</div>
</body>
</html>
